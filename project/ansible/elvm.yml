---
- name: elvm module
  hosts: elvm
  become: yes
  tasks:   
  - name: Creates directory config
    file:
      path: /home/{{ lookup('env','USER') }}/{{item}}
      owner: "{{ lookup('env','USER') }}" 
      group: "{{ lookup('env','USER') }}"
      mode: 0755 
      state: directory 
    with_items:
    - 'test'
    #- 'init'
    #- 'dump'
    #- 'log'     
  - name: Install aptitude
    apt:
      name: aptitude
      state: latest
      update_cache: true
  - name: Install required system packages
    apt:
      pkg:
       # - python-minimal
       - software-properties-common
       - python3-pip
       - virtualenv
       - python3-setuptools
       - guake
       # - xrdp
       - ufw
       # - xfce4 
      state: latest
      update_cache: true    

  - name:  "ufw allow"
   # become: true
    shell: "ufw allow 22 && ufw status"
    register: command_result
    args:
      chdir: /tmp
  - debug:
      msg: "{{ command_result.stdout_lines }}"        
#xrdp     ALL=(ALL:ALL) ALL

#  - name:  "ufw allow"
#   # become: true
#    shell: "xrdp     ALL=(ALL:ALL) ALL"
#    register: command_result
#    args:
#      chdir: /tmp
#  - debug:
#      msg: "{{ command_result.stdout_lines }}"

